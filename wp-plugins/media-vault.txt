{"name":"Media Vault","slug":"media-vault","version":"0.8.12","author":"<a href=\"http:\/\/maxpanas.com\">Max GJ Panas<\/a>","author_profile":"https:\/\/profiles.wordpress.org\/max-gjp\/","contributors":{"max-gjp":{"profile":"https:\/\/profiles.wordpress.org\/max-gjp\/","avatar":"https:\/\/secure.gravatar.com\/avatar\/7dd09b4dc3374a8a671e58027214e914?s=96&d=monsterid&r=g","display_name":"Max GJ Panas"}},"requires":"3.5.0","tested":"3.7.41","requires_php":false,"requires_plugins":[],"rating":88,"ratings":{"5":21,"4":3,"3":0,"2":0,"1":3},"num_ratings":27,"support_threads":1,"support_threads_resolved":0,"active_installs":1000,"last_updated":"2014-02-18 4:48pm GMT","added":"2013-10-18","homepage":"http:\/\/wordpress.org\/plugins\/media-vault\/","sections":{"description":"<h4>Protected Attachment Files<\/h4>\n<p>Media Vault cordons off a section of your WordPress uploads folder and secures it, protecting all files within by passing requests for them through a <em>powerful, flexible and completely customizable<\/em> set of permission checks.<\/p>\n<p>After activating the plugin, to protect attachment files with Media Vault you can:<\/p>\n<ul>\n<li>use the <em>Media Uploader admin page<\/em> to upload new protected attachments,<\/li>\n<li>use the <em>Media Vault metabox<\/em> to toggle file protection on the &#8216;Edit Media&#8217; admin page,<\/li>\n<li>use the the <em>Media Vault Protection Settings<\/em> fields in the new Media Modal, or, <\/li>\n<li>using <em>bulk actions<\/em> in your Media Library page, you can change file protection on multiple pre-existing attachments at once.<\/li>\n<\/ul>\n<p>By default the only permission check that the plugin does on media files is that the user requesting them be logged in. You can change this <em>default<\/em> behavior from the &#8216;Media Settings&#8217; page in the &#8216;Settings&#8217; menu of the WordPress Admin. You can also change the restrictions set on attachments on an individual basis by means of either the Media Vault metabox on the &#8216;Edit Media&#8217; page or the Media Vault Protection Settings fields in the new Media Modal.<\/p>\n<p>You can also write your own custom restrictions using the <code>mgjp_mv_add_permission()<\/code> function. See <a href=\"https:\/\/wordpress.org\/support\/topic\/restrict-only-for-subscribers?replies=5\" rel=\"ugc\">this support question<\/a> for more details.<\/p>\n<h4>Safe Download Links<\/h4>\n<p>Creating a cross-browser compatible download link for a file is a harder task than might be expected. Media Vault handles this for you, and it does so while preserving all the file security features discussed earlier like blocking downloads to people who should not have access to the file.<\/p>\n<p>The download links are available through a simple shortcode that you can use in your post\/page editor screen:<\/p>\n<pre><code>[mv_dl_links ids=\"1,2,3\"]\n<\/code><\/pre>\n<p>where &#8216;ids&#8217; are the comma separated list of attachment ids you would like to make available for download in the list.<\/p>\n<p><em>Note:<\/em> Plugin comes with styles ready for WordPress 3.8+!<\/p>\n<p><em>Note:<\/em>  <strong>Now supports WordPress MultiSite!<\/strong><\/p>\n","installation":"<h4>Install Through your Blog&#8217;s Admin<\/h4>\n<p><em>This sometimes does not to work on <code>localhost<\/code>, so if you&#8217;re running your site off your own computer it&#8217;s simpler to use the second method.<\/em><\/p>\n<ol>\n<li>Go to the &#8216;Plugins&#8217; menu in WordPress and select &#8216;Add New&#8217;.<\/li>\n<li>Type &#8216;Media Vault&#8217; in the Search Box and press the &#8216;Search&#8217; button.<\/li>\n<li>When you find &#8216;Media Vault&#8217;, click &#8216;Install Now&#8217; and after reading it, click &#8216;ok&#8217; on the little alert that pops up.<\/li>\n<li>When the plugin finishes installing, simply click &#8216;Activate Now&#8217;.<\/li>\n<\/ol>\n<h4>Downloading from WordPress.org<\/h4>\n<ol>\n<li>Clicking the big &#8216;Download&#8217; button on the right on this page (wordpress.org\/plugins\/media-vault\/) will download the plugin&#8217;s <code>zip<\/code> folder (<code>mediavault.zip<\/code>).<\/li>\n<li>Upload this <code>zip<\/code> folder to your server; to the <code>\/wp-content\/plugins\/<\/code> directory of the site you wish to install the plugin on.<\/li>\n<li>Extract the contents of the <code>zip<\/code>. Once it is done you can delete the <code>mediavault.zip<\/code> file if you wish.<\/li>\n<li>Activate the plugin through the &#8216;Plugins&#8217; menu in WordPress.<\/li>\n<\/ol>\n<p>Once you have Media Vault activated and fully enabled don&#8217;t forget to go and check out the plugin&#8217;s settings on the &#8216;Media Settings&#8217; page under the admin &#8216;Settings&#8217; menu.<\/p>\n","faq":"\n<h4>How do I toggle File Protection on an existing Attachment?<\/h4>\n<p>\n<p>You have two options. If you only want to toggle File Protection on <strong>a single attachment<\/strong>, you can do it directly from the attachment&#8217;s Edit page. In the &#8216;Media Vault Settings&#8217; metabox in the right column, you can toggle protection by clicking the button that will either say &#8216;Add to Protected&#8217; or &#8216;Remove from Protected&#8217;. Remember to click &#8216;Update&#8217; to save the changes you have made.<\/p>\n<p>If you want to toggle File Protection on <strong>multiple attachments<\/strong>, the plugin comes with two bulk actions that can be performed in the Media Library page in the WordPress Admin. On the Media Library page select the attachment or attachments you would like to manipulate by ticking the box next to their title. Then from the &#8216;bulk options&#8217; dropdown select either the &#8216;Add to Protected&#8217; or &#8216;Remove from Protected&#8217; option and click the &#8216;Apply&#8217; button next to the dropdown.<\/p>\n<p>You can verify that the action took effect by looking at the Media Vault column in the Media Library list table. It will display when an attachment&#8217;s files are protected as well as the permissions set on the particular attachment.<\/p>\n<\/p>\n<h4>Can files uploaded from the front-end be automatically protected?<\/h4>\n<p>\n<p>Yes they can, see <a href=\"https:\/\/wordpress.org\/support\/topic\/default-upload-protection-from-front-end?replies=5\" rel=\"ugc\">this support question<\/a> for more details!<\/p>\n<\/p>\n<h4>How are unprotected files handled? How does this plugin work?<\/h4>\n<p>\n<p>This question was recently asked and answered in <a href=\"https:\/\/wordpress.org\/support\/topic\/how-the-unprotected-files-are-handeled?replies=3\" rel=\"ugc\">this support thread<\/a>, check it out!<\/p>\n<\/p>\n\n","changelog":"<h4>0.8.12<\/h4>\n<p>fixed bug in <code>mv-file-handler.php<\/code> causing php Notice and corrupted files. Big thanks to user <a href=\"https:\/\/profiles.wordpress.org\/ikivanov\" rel=\"nofollow ugc\">ikivanov<\/a> for pointing it out and providing the solution!<\/p>\n<h4>0.8.11<\/h4>\n<ul>\n<li>fixed bug in <code>mv-metaboxes.php<\/code> causing php Notice. Thank you user <a href=\"https:\/\/profiles.wordpress.org\/ikivanov\" rel=\"nofollow ugc\">ikivanov<\/a> for pointing it out!<\/li>\n<li>fixed bug in <code>mv-metaboxes.php<\/code> causing metabox stylesheet not to be served<\/li>\n<\/ul>\n<h4>0.8.10<\/h4>\n<p>Fixed typo causing php error in <code>mv-extra-activation-steps.php<\/code>. Thank you user <a href=\"https:\/\/profiles.wordpress.org\/wwn2013\" rel=\"nofollow ugc\">wwn2013<\/a> for pointing it out!<\/p>\n<h4>0.8.9<\/h4>\n<ul>\n<li>Added Attachment Edit fields to the new Media Modal to make it easier to manage which files are protected with Media Vault and what permissions are set on each protected file.<\/li>\n<li>Fixed visual bug with IE8 and the general sibling selector not showing permissions in the Media Vault Metabox on the attachment edit admin page.<\/li>\n<li>Organized minified js code into seperate folder<\/li>\n<\/ul>\n<h4>0.8.8<\/h4>\n<p>fixed bug in <code>mv-file-handler.php<\/code> that allowed files to be viewed in the protected folder when &#8216;Save uploads in year\/month folders&#8217; was <em>not<\/em> selected. Thanks to <a href=\"https:\/\/profiles.wordpress.org\/wayneharris\" rel=\"nofollow ugc\">WayneHarris<\/a> for pointing the issue out.<\/p>\n<h4>0.8.7<\/h4>\n<p>added a body class to the WP admin to let Media Vault know to use the new 3.8+ styles<\/p>\n<h4>0.8.6<\/h4>\n<p>fixed code that required php 5.4 and above, to be compatible with older versions of php<\/p>\n<h4>0.8.5<\/h4>\n<ul>\n<li>Now the plugin is not fully enabled if the rewrite rules are detected to not be fully functioning as required<\/li>\n<li>Added flag to indicate Media Vault can <strong>only<\/strong> be network activated on WordPress Multisite installs<\/li>\n<li>Added return to homepage link in standard access denied message on protected media<\/li>\n<li>Added Media Vault Activation\/Deactivation Helper (MVADH) to support setups where Media Vault cannot automatically configure all components it needs to function, particularly the rewrite rules. Currently, MVADH supports single &amp; multisite WordPress installs on Apache + mod_rewrite. Support for more server technologies coming soon. <em>MVADH not supporting a particular server technology <strong>does not<\/strong> mean Media Vault cannot work with that technology<\/em>, just that you may need to figure some of how to make the rewrite rules work by yourself.<\/li>\n<li>Added <strong>much<\/strong> better support for WP multisite: better activation support, better deactivation support, better uninstallation support, better rewrite rule support, better file-handling support, better plugin update support.<\/li>\n<li>Added MVADH rewrite rule support for ugly permalink setups<\/li>\n<li>Made some performance tweaks &amp; minor bugfixing<\/li>\n<\/ul>\n<h4>0.8<\/h4>\n<ul>\n<li>added functionality to allow a place-holder image to replace a requested protected image.<\/li>\n<li>refactored permission resolving functions to be more thorough and efficient.<\/li>\n<li>modified <code>mgjp_mv_admin_check_user_permitted()<\/code> function to handle non admin checking and renamed it to <code>mgjp_mv_check_user_permitted()<\/code> to reflect this.<\/li>\n<li>added plugin update handling class to manage per update required changes fluidly.<\/li>\n<li>created an <code>uninstall.php<\/code> file and moved all settings removal actions there so that settings are now saved when a user only deactivates and does not remove the plugin.<\/li>\n<li>added a link to the Media Vault settings to the Plugins page.<\/li>\n<li>fixed bug with the Media Vault metabox not being able to set the default permission on the attachment.<\/li>\n<li>fixed bug with the <code>mgjp_mv_get_the_permission()<\/code> function returning the wrong permission.<\/li>\n<\/ul>\n<h4>0.7.1<\/h4>\n<p>The Metabox &#8211; added a Media Vault metabox to the attachment editor screen to manage protection meta + bugfixing on the bulk actions script<\/p>\n<h4>0.7<\/h4>\n<p><em>Minor remastering of permission checking code to address protected attachment access from within the WordPress backend. Highly recommended to immediately update.<\/em><\/p>\n<ul>\n<li>Rewrote default permissions to return rather than using <code>wp_die<\/code> directly. They now MUST either return <code>true<\/code> upon determining the current user is permitted to access a particular attachment; or if access is denied: <code>false<\/code> or a <a href=\"https:\/\/codex.wordpress.org\/Class_Reference\/WP_Error\" rel=\"nofollow ugc\"><code>WP_Error<\/code><\/a> object with an error message included. <\/li>\n<li>Added <code>mgjp_mv_admin_check_user_permitted()<\/code> function to use permission functions to change access to attachments while within the WP Admin.<\/li>\n<li>Hooked into the &#8216;user_has_cap&#8217; and &#8216;media_row_actions&#8217; filters to restrict what users could see and manipulate in the backend for the specific attachments they did not have the permission to access.<\/li>\n<li>Rewrote the custom permission checking function handling section of the file-handling script <code>mv-file-handler.php<\/code> to accommodate the changes to the way custom permission functions now return values.<\/li>\n<\/ul>\n<h4>0.6<\/h4>\n<p>Initial Release.<\/p>\n","screenshots":"<ol><li><a href=\"https:\/\/ps.w.org\/media-vault\/assets\/screenshot-1.png?rev=789772\"><img src=\"https:\/\/ps.w.org\/media-vault\/assets\/screenshot-1.png?rev=789772\" alt=\"The WordPress Media Upload page with Media Vault file protection activated.\"><\/a><p>The WordPress Media Upload page with Media Vault file protection activated.<\/p><\/li><li><a href=\"https:\/\/ps.w.org\/media-vault\/assets\/screenshot-2.png?rev=789772\"><img src=\"https:\/\/ps.w.org\/media-vault\/assets\/screenshot-2.png?rev=789772\" alt=\"An example of the access denied prompt produced by a custom file access restriction implemented very simply using Media Vault.\"><\/a><p>An example of the access denied prompt produced by a custom file access restriction implemented very simply using Media Vault.<\/p><\/li><li><a href=\"https:\/\/ps.w.org\/media-vault\/assets\/screenshot-3.png?rev=789772\"><img src=\"https:\/\/ps.w.org\/media-vault\/assets\/screenshot-3.png?rev=789772\" alt=\"The WordPress Media Upload page with Media Vault file protection activated (in WP mp6 &amp; WP 3.8+)\"><\/a><p>The WordPress Media Upload page with Media Vault file protection activated (in WP mp6 &amp; WP 3.8+)<\/p><\/li><\/ol>","reviews":"<div class=\"review\">\n\t<div class=\"review-head\">\n\t\t<div class=\"reviewer-info\">\n\t\t\t<div class=\"review-title-section\">\n\t\t\t\t<h4 class=\"review-title\">It&#039;s almost perfect<\/h4>\n\t\t\t\t<div class=\"star-rating\">\n\t\t\t\t<div class=\"wporg-ratings\" aria-label=\"1 out of 5 stars\" data-title-template=\"%s out of 5 stars\" data-rating=\"1\" style=\"color:#ffb900;\"><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-empty\"><\/span><span class=\"star dashicons dashicons-star-empty\"><\/span><span class=\"star dashicons dashicons-star-empty\"><\/span><span class=\"star dashicons dashicons-star-empty\"><\/span><\/div>\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t<p class=\"reviewer\">\n\t\t\t\tBy <a href=\"https:\/\/profiles.wordpress.org\/maxeyle\/\"><img alt='' src='https:\/\/secure.gravatar.com\/avatar\/e6aa4d2a249d18b64a6b3003ae52a08e?s=16&#038;d=monsterid&#038;r=g' srcset='https:\/\/secure.gravatar.com\/avatar\/e6aa4d2a249d18b64a6b3003ae52a08e?s=32&#038;d=monsterid&#038;r=g 2x' class='avatar avatar-16 photo' height='16' width='16' loading='lazy' decoding='async'\/><\/a><a href=\"https:\/\/profiles.wordpress.org\/maxeyle\/\" class=\"reviewer-name\">maxeyle<\/a> on <span class=\"review-date\">January 20, 2020<\/span>\t\t\t<\/p>\n\t\t<\/div>\n\t<\/div>\n\t<div class=\"review-body\">I spent untold hours trying to solve the seemingly simple task of restricting access to certain media uploads to logged in users. All I needed was a way to check a box that would keep people from using a direct url to view private documents, and this finally gave me that function. However, my celebration was short-lived because I realized it was blocking the media url for everyone - including logged in users. So close...<\/div>\n<\/div>\n<div class=\"review\">\n\t<div class=\"review-head\">\n\t\t<div class=\"reviewer-info\">\n\t\t\t<div class=\"review-title-section\">\n\t\t\t\t<h4 class=\"review-title\">Would be amazing if it worked<\/h4>\n\t\t\t\t<div class=\"star-rating\">\n\t\t\t\t<div class=\"wporg-ratings\" aria-label=\"1 out of 5 stars\" data-title-template=\"%s out of 5 stars\" data-rating=\"1\" style=\"color:#ffb900;\"><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-empty\"><\/span><span class=\"star dashicons dashicons-star-empty\"><\/span><span class=\"star dashicons dashicons-star-empty\"><\/span><span class=\"star dashicons dashicons-star-empty\"><\/span><\/div>\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t<p class=\"reviewer\">\n\t\t\t\tBy <a href=\"https:\/\/profiles.wordpress.org\/fatheroftime\/\"><img alt='' src='https:\/\/secure.gravatar.com\/avatar\/e4ecabf355c72d8362533c405e25e602?s=16&#038;d=monsterid&#038;r=g' srcset='https:\/\/secure.gravatar.com\/avatar\/e4ecabf355c72d8362533c405e25e602?s=32&#038;d=monsterid&#038;r=g 2x' class='avatar avatar-16 photo' height='16' width='16' loading='lazy' decoding='async'\/><\/a><a href=\"https:\/\/profiles.wordpress.org\/fatheroftime\/\" class=\"reviewer-name\">fatheroftime<\/a> on <span class=\"review-date\">October 17, 2019<\/span>\t\t\t<\/p>\n\t\t<\/div>\n\t<\/div>\n\t<div class=\"review-body\">This plugin no longer works, but it WOULD do everything I need it to do.\n\nBroken things:\nDoesn't protect PDFs\nDoesn't protect media files by default\nCan still access files through a direct link<\/div>\n<\/div>\n<div class=\"review\">\n\t<div class=\"review-head\">\n\t\t<div class=\"reviewer-info\">\n\t\t\t<div class=\"review-title-section\">\n\t\t\t\t<h4 class=\"review-title\">Great Work<\/h4>\n\t\t\t\t<div class=\"star-rating\">\n\t\t\t\t<div class=\"wporg-ratings\" aria-label=\"5 out of 5 stars\" data-title-template=\"%s out of 5 stars\" data-rating=\"5\" style=\"color:#ffb900;\"><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><\/div>\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t<p class=\"reviewer\">\n\t\t\t\tBy <a href=\"https:\/\/profiles.wordpress.org\/jtvie\/\"><img alt='' src='https:\/\/secure.gravatar.com\/avatar\/72c1648fc87a142cd8a1d876cbc74a73?s=16&#038;d=monsterid&#038;r=g' srcset='https:\/\/secure.gravatar.com\/avatar\/72c1648fc87a142cd8a1d876cbc74a73?s=32&#038;d=monsterid&#038;r=g 2x' class='avatar avatar-16 photo' height='16' width='16' loading='lazy' decoding='async'\/><\/a><a href=\"https:\/\/profiles.wordpress.org\/jtvie\/\" class=\"reviewer-name\">jtvie<\/a> on <span class=\"review-date\">September 3, 2016<\/span>\t\t\t<\/p>\n\t\t<\/div>\n\t<\/div>\n\t<div class=\"review-body\"><p>Use it to secure some of my contents on a mid sized Page.<br \/>\nDid some additional stuff to it:<\/p>\n<ul>\n<li>Woocommerce membership (checks if a user already payed for chosen content or is subscriber)<\/li>\n<li>Add options to the Divi theme&amp;Builder to restrict access to sections\/blocks the same way as the media vault would do<\/li>\n<li>rewritten file serve code to handle ranged\/streamed video and or other big data packages<\/li>\n<li>action added to use an s3 as primary file delivery as private links and the media vault as fallback (fileOnS3?header location s3:serve file)<\/li>\n<\/ul>\n<p>If requested i'll assist on similar topics.<br \/>\nIf anybody is interested in the rewritten file serving php thing:<br \/>\nthe following code is a part of the \"mv-file-handler.php\" file - there where no actions to overrule so i had to modify the original source:<br \/>\n<pre><code>function mgjp_mv_get_file($rel_file, $action = &#039;&#039;){\n\n\t\/\/ $rel_file = path to the file to view\/download,\n\t\/\/ relative to the WP uploads folder\n\t\/\/ (eg:&#039;\/media-vault\/2013\/10\/media-vault-150x150.jpg&#039;)\n\n\t$upload_dir = wp_upload_dir();\n\n\t\/\/ only files in the WP uploads directory are allowed to be accessed:\n\t$file = rtrim($upload_dir[&#039;basedir&#039;], &#039;\/&#039;).str_replace(&#039;..&#039;, &#039;&#039;, isset($rel_file)?$rel_file:&#039;&#039;);\n\n\t\/\/---Basic Checks----------------------------------------------------\/\/\n\n\tif(!$upload_dir[&#039;basedir&#039;] || !is_file($file)){\n\t\tstatus_header(404);\n\t\twp_die(&#039;404. File not found.&#039;);\n\t}\n\n\t$mime = wp_check_filetype($file); \/\/ Check filetype against allowed filetypes\n\n\tif(isset($mime[&#039;type&#039;]) &amp;&amp; $mime[&#039;type&#039;]){\n\t\t$mimetype = $mime[&#039;type&#039;];\n\t}else{\n\t\tstatus_header(403);\n\t\twp_die(__(&#039;403. Forbidden.&lt;br\/&gt;You cannot directly access files of this type in this directory on this server. Please contact the website administrator.&#039;));\n\t}\n\n\t\/\/---Permission Checks-----------------------------------------------\/\/\n\n\t$file_info = pathinfo($rel_file);\n\n\t\/\/ check if file is protected by checking\n\t\/\/ if it is in the protected folder before\n\t\/\/ doing any permission checks\n\tif(0 === stripos($file_info[&#039;dirname&#039;].&#039;\/&#039;, mgjp_mv_upload_dir(&#039;\/&#039;, true))){\n\n\t\t\/\/ disable caching of this page by caching plugins ------\/\/\n\t\tif(!defined(&#039;DONOTCACHEPAGE&#039;))\n\t\t\tdefine(&#039;DONOTCACHEPAGE&#039;, 1);\n\n\t\tif(!defined(&#039;DONOTCACHEOBJECT&#039;))\n\t\t\tdefine(&#039;DONOTCACHEOBJECT&#039;, 1);\n\n\t\tif(!defined(&#039;DONOTMINIFY&#039;))\n\t\t\tdefine(&#039;DONOTMINIFY&#039;, 1);\n\n\t\t\/\/-------------------------------------------------------\/\/\n\n\t\t\/\/ try and get attachment id from url -------------------\/\/\n\t\tglobal $wpdb;\n\t\t$attachments = $wpdb-&gt;get_results(\n\t\t\t$wpdb-&gt;prepare(\n\t\t\t\t&quot;\n        SELECT      post_id, meta_value\n        FROM        $wpdb-&gt;postmeta\n        WHERE       meta_key = %s\n                    AND meta_value LIKE %s\n        &quot;,\n\t\t\t\t&#039;_wp_attachment_metadata&#039;,\n\t\t\t\t&#039;%&#039;.$file_info[&#039;basename&#039;].&#039;%&#039;\n\t\t\t), ARRAY_A\n\t\t);\n\n\t\t$attachment_id = false;\n\t\tforeach($attachments as $attachment){\n\n\t\t\t$meta_value = unserialize($attachment[&#039;meta_value&#039;]);\n\n\t\t\tif(ltrim(dirname($meta_value[&#039;file&#039;]), &#039;\/&#039;) == ltrim($file_info[&#039;dirname&#039;], &#039;\/&#039;)){\n\t\t\t\t$attachment_id = $attachment[&#039;post_id&#039;];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t\/\/ ------------------------------------------------------\/\/\n\n\t\tif(!$permission = mgjp_mv_get_the_permission($attachment_id))\n\t\t\t$permission = get_option(&#039;mgjp_mv_default_permission&#039;, &#039;logged-in&#039;);\n\n\t\t$permissions = mgjp_mv_get_the_permissions();\n\n\t\t\/\/ permission set up error detection\n\t\t$standard_error_txt = &#039; &#039;.esc_html__(&#039;Therefore for safety and privacy reasons this file is unavailable. Please contact the website administrator.&#039;, &#039;media-vault&#039;).&#039;&lt;p&gt;&lt;a href=&quot;&#039;.home_url().&#039;&quot;&gt;&amp;larr;&#039;.esc_html__(&#039;Return to homepage&#039;, &#039;media-vault&#039;).&#039;&lt;\/a&gt;&lt;\/p&gt;&#039;;\n\n\t\tif(!isset($permissions[$permission]))\n\t\t\twp_die(__(&#039;The permissions set for this file are not recognized.&#039;, &#039;media-vault&#039;).$standard_error_txt);\n\n\t\tif(!isset($permissions[$permission][&#039;logged_in&#039;]))\n\t\t\t$errors[] = &#039;logged_in&#039;;\n\t\tif(!isset($permissions[$permission][&#039;cb&#039;]))\n\t\t\t$errors[] = &#039;cb&#039;;\n\t\tif(isset($errors)){\n\t\t\t$error_txt = __(&#039;The permissions set for this file have left the following important parameters undefined:&#039;, &#039;media-vault&#039;)\n\t\t\t\t.&#039;&lt;ul&gt;&lt;li&gt;\\&#039;&#039;.implode(&#039;\\&#039;&lt;\/li&gt;&lt;li&gt;\\&#039;&#039;, $errors).&#039;\\&#039;&lt;\/li&gt;&lt;\/ul&gt;&#039;\n\t\t\t\t.&#039;&lt;p&gt;&#039;.$standard_error_txt.&#039;&lt;\/p&gt;&#039;;\n\t\t\twp_die($error_txt);\n\t\t}\n\n\t\tif($permissions[$permission][&#039;logged_in&#039;])\n\t\t\tis_user_logged_in() || auth_redirect(); \/\/ using is_user_logged_in is lighter than using just auth_redirect\n\n\t\tif(false !== $permissions[$permission][&#039;cb&#039;]){\n\n\t\t\tif(!is_callable($permissions[$permission][&#039;cb&#039;]))\n\t\t\t\twp_die(__(&#039;The permission checking function set in this file\\&#039;s permissions is not callable.&#039;, &#039;media-vault&#039;).$standard_error_txt);\n\n\t\t\t$permission_check = call_user_func_array($permissions[$permission][&#039;cb&#039;], array($attachment_id, $rel_file, $file));\n\n\t\t\tif(is_wp_error($permission_check))\n\t\t\t\twp_die($permission_check-&gt;get_error_message().$standard_error_txt);\n\n\t\t\tif(true !== $permission_check)\n\t\t\t\twp_die(__(&#039;You do not have sufficient permissions to view this file.&#039;, &#039;media-vault&#039;).$standard_error_txt);\n\t\t}\n\n\t\tif(function_exists(&#039;attachment_get_remote_url&#039;) &amp;&amp; $remote_url = attachment_get_remote_url($attachment_id)){\n\t\t\theader(&quot;Location: &quot;.$remote_url,TRUE,307);\n\t\t}\n\n\t} \/\/ end of permission checks\n\n\t\/\/-------------------------------------------------------------------\/\/\n\n\t$filesize = filesize($file);\n\theader(&#039;Content-Type: &#039;.$mimetype); \/\/ always send this\n\tif(false === strpos($_SERVER[&#039;SERVER_SOFTWARE&#039;], &#039;Microsoft-IIS&#039;))\n\t\theader(&#039;Content-Length: &#039;.$filesize);\n\n\tif(&#039;safeforce&#039; !== $action){\n\t\t\/\/--OPEN FILE IN BROWSER functions-------------\/\/\n\n\t\t$last_modified = gmdate(&#039;D, d M Y H:i:s&#039;, filemtime($file));\n\t\t$etag = &#039;&quot;&#039;.md5($last_modified).&#039;&quot;&#039;;\n\t\theader(&quot;Last-Modified: $last_modified GMT&quot;);\n\t\theader(&#039;ETag: &#039;.$etag);\n\t\theader(&#039;Cache-Control: no-store, no-cache, must-revalidate&#039;); \/\/ HTTP 1.1.\n\t\theader(&#039;Pragma: no-cache&#039;); \/\/ HTTP 1.0.\n\t\theader(&#039;Expires: Thu, 01 Dec 1994 16:00:00 GMT&#039;); \/\/ Proxies\n\n\t\t\/\/ Support for Conditional GET\n\t\t$client_etag = isset($_SERVER[&#039;HTTP_IF_NONE_MATCH&#039;])?stripslashes($_SERVER[&#039;HTTP_IF_NONE_MATCH&#039;]):false;\n\n\t\tif(!isset($_SERVER[&#039;HTTP_IF_MODIFIED_SINCE&#039;]))\n\t\t\t$_SERVER[&#039;HTTP_IF_MODIFIED_SINCE&#039;] = false;\n\n\t\t$client_last_modified = trim($_SERVER[&#039;HTTP_IF_MODIFIED_SINCE&#039;]);\n\t\t\/\/ If string is empty, return 0. If not, attempt to parse into a timestamp\n\t\t$client_modified_timestamp = $client_last_modified?strtotime($client_last_modified):0;\n\n\t\t\/\/ Make a timestamp for our most recent modification...\n\t\t$modified_timestamp = strtotime($last_modified);\n\n\t\tif(($client_last_modified &amp;&amp; $client_etag)\n\t\t\t?(($client_modified_timestamp &gt;= $modified_timestamp) &amp;&amp; ($client_etag == $etag))\n\t\t\t:(($client_modified_timestamp &gt;= $modified_timestamp) || ($client_etag == $etag))\n\t\t){\n\t\t\tstatus_header(304);\n\t\t\texit;\n\t\t}\n\n\t}else{\n\t\t\/\/--FORCE DOWNLOAD Functions-----------------------\/\/\n\n\t\t\/\/ required for IE, otherwise Content-disposition is ignored\n\t\tif(ini_get(&#039;zlib.output_compression&#039;))\n\t\t\tini_set(&#039;zlib.output_compression&#039;, &#039;Off&#039;);\n\n\t\theader(&#039;Pragma: public&#039;); \/\/ required\n\t\theader(&#039;Expires: 0&#039;);\n\t\theader(&#039;Cache-Control: must-revalidate, post-check=0, pre-check=0&#039;);\n\t\theader(&#039;Cache-Control: private&#039;, false); \/\/ required for certain browsers\n\t\theader(&#039;Content-Disposition: attachment; filename=&quot;&#039;.$file_info[&#039;basename&#039;].&#039;&quot;;&#039;);\n\t\theader(&#039;Content-Transfer-Encoding: binary&#039;);\n\n\t}\n\n\t\/\/ If we made it this far, just serve the file\n\tif(ob_get_length())\n\t\tob_clean();\n\t$filesize = filesize($file);\n\t\/\/Handel partial request\n\theader(&quot;Accept-Ranges: 0-$filesize&quot;);\n\t$buffer_size = 1024 * 1024; \/\/1MB #bigger = more ram usage but less cpu\n\tif(isset($_SERVER[&#039;HTTP_RANGE&#039;])){\n\t\tpreg_match(&#039;\/bytes=(\\d+)-(\\d+)?\/&#039;, $_SERVER[&#039;HTTP_RANGE&#039;], $matches);\n\t\t$offset = intval($matches[1]);\n\t\t$length = intval(isset($matches[2])?intval($matches[2]) - $offset:$filesize - $offset);\n\t\tif($length &lt; 1) $length = $filesize - $offset;\n\t\tif($length &gt; $buffer_size*10) $length = $buffer_size*10;\/\/limit max partial *will trigger a ERR_CONTENT_LENGTH_MISMATCH on client but will perform better...\n\t\theader(&#039;HTTP\/1.1 206 Partial Content&#039;);\n\t\theader(&#039;Content-Range: bytes &#039;.$offset.&#039;-&#039;.($offset + $length).&#039;\/&#039;.$filesize);\n\t\t$file = fopen($file, &#039;r&#039;);\n\n\t\t\/\/ seek to the requested offset, this is 0 if it&#039;s not a partial content request\n\t\tfseek($file, $offset);\n\t\t\/\/split the file so we could &lt;code&gt;stream&lt;\/code&gt; just the range we need\n\t\twhile($length &gt; 0 &amp;&amp; !feof($file)){\n\t\t\tif($length &gt; $buffer_size)\n\t\t\t\t$bytes_to_read = $buffer_size;\n\t\t\telse\n\t\t\t\t$bytes_to_read = $length;\n\t\t\t$length -= $bytes_to_read;\n\t\t\techo fread($file, $bytes_to_read);\n\t\t\tflush();\n\t\t}\n\t\tfclose($file);\n\t\texit;\n\t}\n\tflush();\n\treadfile($file);\n\texit;\n}<\/code><\/pre>\n<\/div>\n<\/div>\n<div class=\"review\">\n\t<div class=\"review-head\">\n\t\t<div class=\"reviewer-info\">\n\t\t\t<div class=\"review-title-section\">\n\t\t\t\t<h4 class=\"review-title\">Very useful<\/h4>\n\t\t\t\t<div class=\"star-rating\">\n\t\t\t\t<div class=\"wporg-ratings\" aria-label=\"5 out of 5 stars\" data-title-template=\"%s out of 5 stars\" data-rating=\"5\" style=\"color:#ffb900;\"><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><\/div>\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t<p class=\"reviewer\">\n\t\t\t\tBy <a href=\"https:\/\/profiles.wordpress.org\/dimgord\/\"><img alt='' src='https:\/\/secure.gravatar.com\/avatar\/6457691065ac4c423596c69767908f29?s=16&#038;d=monsterid&#038;r=g' srcset='https:\/\/secure.gravatar.com\/avatar\/6457691065ac4c423596c69767908f29?s=32&#038;d=monsterid&#038;r=g 2x' class='avatar avatar-16 photo' height='16' width='16' loading='lazy' decoding='async'\/><\/a><a href=\"https:\/\/profiles.wordpress.org\/dimgord\/\" class=\"reviewer-name\">dimgord<\/a> on <span class=\"review-date\">September 3, 2016<\/span>\t\t\t<\/p>\n\t\t<\/div>\n\t<\/div>\n\t<div class=\"review-body\"><p>Found it while looking for restriction view access - it's just what I needed, thanks a lot!\n<\/p>\n<\/div>\n<\/div>\n<div class=\"review\">\n\t<div class=\"review-head\">\n\t\t<div class=\"reviewer-info\">\n\t\t\t<div class=\"review-title-section\">\n\t\t\t\t<h4 class=\"review-title\">Great, but the future?<\/h4>\n\t\t\t\t<div class=\"star-rating\">\n\t\t\t\t<div class=\"wporg-ratings\" aria-label=\"5 out of 5 stars\" data-title-template=\"%s out of 5 stars\" data-rating=\"5\" style=\"color:#ffb900;\"><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><\/div>\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t<p class=\"reviewer\">\n\t\t\t\tBy <a href=\"https:\/\/profiles.wordpress.org\/mojamba\/\"><img alt='' src='https:\/\/secure.gravatar.com\/avatar\/3e3b3706038b20b9d1291c83b6e952f2?s=16&#038;d=monsterid&#038;r=g' srcset='https:\/\/secure.gravatar.com\/avatar\/3e3b3706038b20b9d1291c83b6e952f2?s=32&#038;d=monsterid&#038;r=g 2x' class='avatar avatar-16 photo' height='16' width='16' loading='lazy' decoding='async'\/><\/a><a href=\"https:\/\/profiles.wordpress.org\/mojamba\/\" class=\"reviewer-name\">mojamba<\/a> on <span class=\"review-date\">September 3, 2016<\/span>\t\t\t<\/p>\n\t\t<\/div>\n\t<\/div>\n\t<div class=\"review-body\"><p>Recently installed and started using this plugin and it works wonderfully. But, seeing how long it has been since last being updated, I do worry if it will break in some future WP update. For now, all good. Let's hope someone keeps this plugin active as I didn't see any other plugin trying to solve this problem (which, itself, was a huge surprise).\n<\/p>\n<\/div>\n<\/div>\n<div class=\"review\">\n\t<div class=\"review-head\">\n\t\t<div class=\"reviewer-info\">\n\t\t\t<div class=\"review-title-section\">\n\t\t\t\t<h4 class=\"review-title\">Perfect plugin for member areas<\/h4>\n\t\t\t\t<div class=\"star-rating\">\n\t\t\t\t<div class=\"wporg-ratings\" aria-label=\"4 out of 5 stars\" data-title-template=\"%s out of 5 stars\" data-rating=\"4\" style=\"color:#ffb900;\"><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-empty\"><\/span><\/div>\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t<p class=\"reviewer\">\n\t\t\t\tBy <a href=\"https:\/\/profiles.wordpress.org\/wyzyncom\/\"><img alt='' src='https:\/\/secure.gravatar.com\/avatar\/7b355dd271bfed797e8b4ac8e8373f66?s=16&#038;d=monsterid&#038;r=g' srcset='https:\/\/secure.gravatar.com\/avatar\/7b355dd271bfed797e8b4ac8e8373f66?s=32&#038;d=monsterid&#038;r=g 2x' class='avatar avatar-16 photo' height='16' width='16' loading='lazy' decoding='async'\/><\/a><a href=\"https:\/\/profiles.wordpress.org\/wyzyncom\/\" class=\"reviewer-name\">wyzyncom<\/a> on <span class=\"review-date\">September 3, 2016<\/span>\t\t\t<\/p>\n\t\t<\/div>\n\t<\/div>\n\t<div class=\"review-body\"><p>Good plugin for securing \/ hiding media files (PDF's and images) that are only to be seen in the member area by logged-in users. Member management plugins like Ultimate Member don't offer this option. Result is that files which are imported into a member page are still publicly visible and accessable. Not good, because the member area and all its components should be visible by logged on members only. A big flaw in WordPress, as far as I'm concerned. But this plugin solves the problem easy and in an intuitive way.<\/p>\n<p>Why not a 5 star rating? Because I think it's a pitty that this plugin hasn't been updated for a long time. Really hope the developer will restart his project. I would wanna pay for this plugin.\n<\/p>\n<\/div>\n<\/div>\n<div class=\"review\">\n\t<div class=\"review-head\">\n\t\t<div class=\"reviewer-info\">\n\t\t\t<div class=\"review-title-section\">\n\t\t\t\t<h4 class=\"review-title\">Looks great<\/h4>\n\t\t\t\t<div class=\"star-rating\">\n\t\t\t\t<div class=\"wporg-ratings\" aria-label=\"5 out of 5 stars\" data-title-template=\"%s out of 5 stars\" data-rating=\"5\" style=\"color:#ffb900;\"><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><span class=\"star dashicons dashicons-star-filled\"><\/span><\/div>\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t<p class=\"reviewer\">\n\t\t\t\tBy <a href=\"https:\/\/profiles.wordpress.org\/martinsauter\/\"><img alt='' src='https:\/\/secure.gravatar.com\/avatar\/cdb47adc58cd4fd25b578d85efb10198?s=16&#038;d=monsterid&#038;r=g' srcset='https:\/\/secure.gravatar.com\/avatar\/cdb47adc58cd4fd25b578d85efb10198?s=32&#038;d=monsterid&#038;r=g 2x' class='avatar avatar-16 photo' height='16' width='16' loading='lazy' decoding='async'\/><\/a><a href=\"https:\/\/profiles.wordpress.org\/martinsauter\/\" class=\"reviewer-name\">Martin Sauter <small>(martin.sauter)<\/small><\/a> on <span class=\"review-date\">September 3, 2016<\/span>\t\t\t<\/p>\n\t\t<\/div>\n\t<\/div>\n\t<div class=\"review-body\"><p>I installed this plug-in 2 minutes ago, it was absolutely straigh forward and does exactly what I expected. This plug-in deserves more attention from the WordPress community since it solves a major security problem of WordPress. Hopefully the developer continues his work. And yes: We would pay for this plug-in as well!\n<\/p>\n<\/div>\n<\/div>\n"},"download_link":"https:\/\/downloads.wordpress.org\/plugin\/media-vault.0.8.12.zip","screenshots":{"1":{"src":"https:\/\/ps.w.org\/media-vault\/assets\/screenshot-1.png?rev=789772","caption":"The WordPress Media Upload page with Media Vault file protection activated."},"2":{"src":"https:\/\/ps.w.org\/media-vault\/assets\/screenshot-2.png?rev=789772","caption":"An example of the access denied prompt produced by a custom file access restriction implemented very simply using Media Vault."},"3":{"src":"https:\/\/ps.w.org\/media-vault\/assets\/screenshot-3.png?rev=789772","caption":"The WordPress Media Upload page with Media Vault file protection activated (in WP mp6 &amp; WP 3.8+)"}},"tags":{"attachments":"attachments","downloads":"downloads","media":"media","protection":"protection","security":"security"},"versions":{"0.6":"https:\/\/downloads.wordpress.org\/plugin\/media-vault.0.6.zip","0.7":"https:\/\/downloads.wordpress.org\/plugin\/media-vault.0.7.zip","0.7.1":"https:\/\/downloads.wordpress.org\/plugin\/media-vault.0.7.1.zip","0.8":"https:\/\/downloads.wordpress.org\/plugin\/media-vault.0.8.zip","0.8.10":"https:\/\/downloads.wordpress.org\/plugin\/media-vault.0.8.10.zip","0.8.11":"https:\/\/downloads.wordpress.org\/plugin\/media-vault.0.8.11.zip","0.8.12":"https:\/\/downloads.wordpress.org\/plugin\/media-vault.0.8.12.zip","0.8.5":"https:\/\/downloads.wordpress.org\/plugin\/media-vault.0.8.5.zip","0.8.6":"https:\/\/downloads.wordpress.org\/plugin\/media-vault.0.8.6.zip","0.8.7":"https:\/\/downloads.wordpress.org\/plugin\/media-vault.0.8.7.zip","0.8.8":"https:\/\/downloads.wordpress.org\/plugin\/media-vault.0.8.8.zip","0.8.9":"https:\/\/downloads.wordpress.org\/plugin\/media-vault.0.8.9.zip","trunk":"https:\/\/downloads.wordpress.org\/plugin\/media-vault.zip"},"donate_link":"https:\/\/www.paypal.com\/cgi-bin\/webscr?cmd=_s-xclick&hosted_button_id=6KFT65LQXEHFQ","banners":{"low":"https:\/\/ps.w.org\/media-vault\/assets\/banner-772x250.jpg?rev=813330","high":"https:\/\/ps.w.org\/media-vault\/assets\/banner-1544x500.jpg?rev=813330"}}